generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum JobStatus {
  OPEN
  CLOSED
  PAUSED
  EXTENDED
}

enum ApplicationStatus {
  RECEIVED
  SHORTLISTED
  REJECTED
  INTERVIEW
  HIRED
}

enum AIRecommendation {
  STRONGLY_RECOMMENDED
  RECOMMENDED
  NEUTRAL
  NOT_RECOMMENDED
}

enum TeamRole {
  ADMIN
  RECRUITER
  HR_MANAGER
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELED
}

model User {
  id              String           @id
  name            String
  email           String
  emailVerified   Boolean          @default(false)
  image           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  sessions        Session[]
  accounts        Account[]
  employerProfile EmployerProfile?
  jobs            Job[]
  teamMemberships TeamMember[]
  notes           Note[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model EmployerProfile {
  id          String       @id @default(uuid())
  companyName String
  email       String       @unique
  password    String
  logoUrl     String?
  teamMembers TeamMember[]
  userId      String       @unique
  userid      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Job {
  id           String  @id @default(uuid())
  title        String
  description  String
  requirements String
  aiEnabled    Boolean @default(true)

  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  salaryMin   Int
  salaryMax   Int
  currency    String   @default("USD")
  location    String?
  remote      Boolean   @default(false)
  companyName String
  deadline     DateTime @default(now())
  category  String

  applications Application[]

  status JobStatus @default(OPEN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Application {
  id String @id @default(uuid())

  fullName            String
  email               String
  phone               String?
  linkedinUrl         String?
  portfolioUrl        String?
  userSelfDescription String
  resumeUrl           String
  audioIntroUrl       String? // optional audio introduction
  aiScore             Float?
  aiSummary           String?
  aiKeywords          String[]
  aiRecommendation    AIRecommendation?
  notesOnUser         Note[]
  jobId               String
  job                 Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  status ApplicationStatus @default(RECEIVED)

  AIanalysis AIAnalysis?
  interviews ScheduledInterview?

  createdAt DateTime @default(now())

  @@index([jobId])
  @@index([aiScore])
}

model AIAnalysis {
  id            String      @id @default(uuid())
  applicationId String      @unique
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  resumeScore     Float?
  audioScore      Float?
  cultureFitScore Float?
  experienceScore Float?

  extractedSkills String[]
  detectedTone    String?
  riskFlags       String[]

  createdAt DateTime @default(now())
}

model TeamMember {
  id         String          @id @default(uuid())
  email      String          @unique
  role       TeamRole
  userId     String
  userid     User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  employerId String
  employer   EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
}

model Note {
  id          String @id @default(uuid())
  content     String
  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id], onDelete: Cascade)

  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  createdAt     DateTime    @default(now())
}

model ScheduledInterview {
  id            String          @id @default(uuid())
  date          DateTime
  location      String?
  interviewType String // e.g., Video, In-person
  status        InterviewStatus @default(SCHEDULED)

  candidateId String      @unique
  candidate   Application @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
